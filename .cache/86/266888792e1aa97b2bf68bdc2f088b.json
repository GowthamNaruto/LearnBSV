{"id":"JPaM","dependencies":[{"name":"D:\\Aruljothi\\Learning-01\\new\\The Complete-node bootcamp\\complete-node-bootcamp-master\\4-natours\\learnBSV\\package.json","includedInParent":true,"mtime":1657948684510},{"name":"mongoose","loc":{"line":1,"column":25,"index":25},"parent":"D:\\Aruljothi\\Learning-01\\new\\The Complete-node bootcamp\\complete-node-bootcamp-master\\4-natours\\learnBSV\\models\\progressModel.js","resolved":"D:\\Aruljothi\\Learning-01\\new\\The Complete-node bootcamp\\complete-node-bootcamp-master\\4-natours\\learnBSV\\node_modules\\mongoose\\dist\\browser.umd.js"},{"name":"./tourModel","loc":{"line":2,"column":21,"index":60},"parent":"D:\\Aruljothi\\Learning-01\\new\\The Complete-node bootcamp\\complete-node-bootcamp-master\\4-natours\\learnBSV\\models\\progressModel.js","resolved":"D:\\Aruljothi\\Learning-01\\new\\The Complete-node bootcamp\\complete-node-bootcamp-master\\4-natours\\learnBSV\\models\\tourModel.js"}],"generated":{"js":"var e=require(\"mongoose\"),r=require(\"./tourModel\"),t=new e.Schema({progress:[Number],createdAt:{type:Date,default:Date.now},lesson:{type:e.Schema.ObjectId,ref:\"Lesson\"},course:{type:e.Schema.ObjectId,ref:\"Course\"},user:{type:e.Schema.ObjectId,ref:\"User\",required:[!0,\"Progress must belong to an user.\"]}},{toJSON:{virtuals:!0},toObject:{virtuals:!0}});t.index({lesson:1,user:1},{unique:!0}),t.pre(/^find/,function(e){this.populate({path:\"user\",select:\"name photo\"}),e()});var s=e.model(\"Progress\",t);module.exports=s;"},"sourceMaps":{"js":{"mappings":[{"source":"../../models/progressModel.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"../../models/progressModel.js","name":"mongoose","original":{"line":1,"column":6},"generated":{"line":1,"column":4}},{"source":"../../models/progressModel.js","name":"require","original":{"line":1,"column":17},"generated":{"line":1,"column":6}},{"source":"../../models/progressModel.js","original":{"line":1,"column":25},"generated":{"line":1,"column":14}},{"source":"../../models/progressModel.js","name":"Tour","original":{"line":2,"column":6},"generated":{"line":1,"column":26}},{"source":"../../models/progressModel.js","name":"require","original":{"line":2,"column":13},"generated":{"line":1,"column":28}},{"source":"../../models/progressModel.js","original":{"line":2,"column":21},"generated":{"line":1,"column":36}},{"source":"../../models/progressModel.js","name":"progressSchema","original":{"line":4,"column":6},"generated":{"line":1,"column":51}},{"source":"../../models/progressModel.js","original":{"line":4,"column":23},"generated":{"line":1,"column":53}},{"source":"../../models/progressModel.js","name":"mongoose","original":{"line":4,"column":27},"generated":{"line":1,"column":57}},{"source":"../../models/progressModel.js","name":"Schema","original":{"line":4,"column":36},"generated":{"line":1,"column":59}},{"source":"../../models/progressModel.js","original":{"line":5,"column":2},"generated":{"line":1,"column":66}},{"source":"../../models/progressModel.js","name":"progress","original":{"line":6,"column":4},"generated":{"line":1,"column":67}},{"source":"../../models/progressModel.js","original":{"line":6,"column":14},"generated":{"line":1,"column":76}},{"source":"../../models/progressModel.js","name":"Number","original":{"line":6,"column":15},"generated":{"line":1,"column":77}},{"source":"../../models/progressModel.js","name":"createdAt","original":{"line":7,"column":4},"generated":{"line":1,"column":85}},{"source":"../../models/progressModel.js","original":{"line":7,"column":15},"generated":{"line":1,"column":95}},{"source":"../../models/progressModel.js","name":"type","original":{"line":8,"column":6},"generated":{"line":1,"column":96}},{"source":"../../models/progressModel.js","name":"Date","original":{"line":8,"column":12},"generated":{"line":1,"column":101}},{"source":"../../models/progressModel.js","name":"default","original":{"line":9,"column":6},"generated":{"line":1,"column":106}},{"source":"../../models/progressModel.js","name":"Date","original":{"line":9,"column":15},"generated":{"line":1,"column":114}},{"source":"../../models/progressModel.js","name":"now","original":{"line":9,"column":20},"generated":{"line":1,"column":119}},{"source":"../../models/progressModel.js","name":"lesson","original":{"line":11,"column":4},"generated":{"line":1,"column":124}},{"source":"../../models/progressModel.js","original":{"line":11,"column":12},"generated":{"line":1,"column":131}},{"source":"../../models/progressModel.js","name":"type","original":{"line":12,"column":6},"generated":{"line":1,"column":132}},{"source":"../../models/progressModel.js","name":"mongoose","original":{"line":12,"column":12},"generated":{"line":1,"column":137}},{"source":"../../models/progressModel.js","name":"Schema","original":{"line":12,"column":21},"generated":{"line":1,"column":139}},{"source":"../../models/progressModel.js","name":"ObjectId","original":{"line":12,"column":28},"generated":{"line":1,"column":146}},{"source":"../../models/progressModel.js","name":"ref","original":{"line":13,"column":6},"generated":{"line":1,"column":155}},{"source":"../../models/progressModel.js","original":{"line":13,"column":11},"generated":{"line":1,"column":159}},{"source":"../../models/progressModel.js","name":"course","original":{"line":16,"column":4},"generated":{"line":1,"column":169}},{"source":"../../models/progressModel.js","original":{"line":16,"column":12},"generated":{"line":1,"column":176}},{"source":"../../models/progressModel.js","name":"type","original":{"line":17,"column":6},"generated":{"line":1,"column":177}},{"source":"../../models/progressModel.js","name":"mongoose","original":{"line":17,"column":12},"generated":{"line":1,"column":182}},{"source":"../../models/progressModel.js","name":"Schema","original":{"line":17,"column":21},"generated":{"line":1,"column":184}},{"source":"../../models/progressModel.js","name":"ObjectId","original":{"line":17,"column":28},"generated":{"line":1,"column":191}},{"source":"../../models/progressModel.js","name":"ref","original":{"line":18,"column":6},"generated":{"line":1,"column":200}},{"source":"../../models/progressModel.js","original":{"line":18,"column":11},"generated":{"line":1,"column":204}},{"source":"../../models/progressModel.js","name":"user","original":{"line":21,"column":4},"generated":{"line":1,"column":214}},{"source":"../../models/progressModel.js","original":{"line":21,"column":10},"generated":{"line":1,"column":219}},{"source":"../../models/progressModel.js","name":"type","original":{"line":22,"column":6},"generated":{"line":1,"column":220}},{"source":"../../models/progressModel.js","name":"mongoose","original":{"line":22,"column":12},"generated":{"line":1,"column":225}},{"source":"../../models/progressModel.js","name":"Schema","original":{"line":22,"column":21},"generated":{"line":1,"column":227}},{"source":"../../models/progressModel.js","name":"ObjectId","original":{"line":22,"column":28},"generated":{"line":1,"column":234}},{"source":"../../models/progressModel.js","name":"ref","original":{"line":23,"column":6},"generated":{"line":1,"column":243}},{"source":"../../models/progressModel.js","original":{"line":23,"column":11},"generated":{"line":1,"column":247}},{"source":"../../models/progressModel.js","name":"required","original":{"line":24,"column":6},"generated":{"line":1,"column":254}},{"source":"../../models/progressModel.js","original":{"line":24,"column":16},"generated":{"line":1,"column":263}},{"source":"../../models/progressModel.js","original":{"line":24,"column":17},"generated":{"line":1,"column":265}},{"source":"../../models/progressModel.js","original":{"line":24,"column":23},"generated":{"line":1,"column":267}},{"source":"../../models/progressModel.js","original":{"line":27,"column":2},"generated":{"line":1,"column":305}},{"source":"../../models/progressModel.js","name":"toJSON","original":{"line":28,"column":4},"generated":{"line":1,"column":306}},{"source":"../../models/progressModel.js","original":{"line":28,"column":12},"generated":{"line":1,"column":313}},{"source":"../../models/progressModel.js","name":"virtuals","original":{"line":28,"column":14},"generated":{"line":1,"column":314}},{"source":"../../models/progressModel.js","original":{"line":28,"column":24},"generated":{"line":1,"column":324}},{"source":"../../models/progressModel.js","name":"toObject","original":{"line":29,"column":4},"generated":{"line":1,"column":327}},{"source":"../../models/progressModel.js","original":{"line":29,"column":14},"generated":{"line":1,"column":336}},{"source":"../../models/progressModel.js","name":"virtuals","original":{"line":29,"column":16},"generated":{"line":1,"column":337}},{"source":"../../models/progressModel.js","original":{"line":29,"column":26},"generated":{"line":1,"column":347}},{"source":"../../models/progressModel.js","name":"progressSchema","original":{"line":33,"column":0},"generated":{"line":1,"column":352}},{"source":"../../models/progressModel.js","name":"index","original":{"line":33,"column":15},"generated":{"line":1,"column":354}},{"source":"../../models/progressModel.js","original":{"line":33,"column":21},"generated":{"line":1,"column":360}},{"source":"../../models/progressModel.js","name":"lesson","original":{"line":33,"column":23},"generated":{"line":1,"column":361}},{"source":"../../models/progressModel.js","original":{"line":33,"column":31},"generated":{"line":1,"column":368}},{"source":"../../models/progressModel.js","name":"user","original":{"line":33,"column":34},"generated":{"line":1,"column":370}},{"source":"../../models/progressModel.js","original":{"line":33,"column":40},"generated":{"line":1,"column":375}},{"source":"../../models/progressModel.js","original":{"line":33,"column":45},"generated":{"line":1,"column":378}},{"source":"../../models/progressModel.js","name":"unique","original":{"line":33,"column":47},"generated":{"line":1,"column":379}},{"source":"../../models/progressModel.js","original":{"line":33,"column":55},"generated":{"line":1,"column":387}},{"source":"../../models/progressModel.js","name":"progressSchema","original":{"line":36,"column":0},"generated":{"line":1,"column":391}},{"source":"../../models/progressModel.js","name":"pre","original":{"line":36,"column":15},"generated":{"line":1,"column":393}},{"source":"../../models/progressModel.js","original":{"line":36,"column":19},"generated":{"line":1,"column":397}},{"source":"../../models/progressModel.js","original":{"line":36,"column":28},"generated":{"line":1,"column":405}},{"source":"../../models/progressModel.js","name":"next","original":{"line":36,"column":38},"generated":{"line":1,"column":414}},{"source":"../../models/progressModel.js","original":{"line":44,"column":2},"generated":{"line":1,"column":417}},{"source":"../../models/progressModel.js","name":"populate","original":{"line":44,"column":7},"generated":{"line":1,"column":422}},{"source":"../../models/progressModel.js","original":{"line":44,"column":16},"generated":{"line":1,"column":431}},{"source":"../../models/progressModel.js","name":"path","original":{"line":45,"column":4},"generated":{"line":1,"column":432}},{"source":"../../models/progressModel.js","original":{"line":45,"column":10},"generated":{"line":1,"column":437}},{"source":"../../models/progressModel.js","name":"select","original":{"line":46,"column":4},"generated":{"line":1,"column":444}},{"source":"../../models/progressModel.js","original":{"line":46,"column":12},"generated":{"line":1,"column":451}},{"source":"../../models/progressModel.js","name":"next","original":{"line":48,"column":2},"generated":{"line":1,"column":466}},{"source":"../../models/progressModel.js","original":{"line":93,"column":0},"generated":{"line":1,"column":472}},{"source":"../../models/progressModel.js","name":"Progress","original":{"line":93,"column":6},"generated":{"line":1,"column":476}},{"source":"../../models/progressModel.js","name":"mongoose","original":{"line":93,"column":17},"generated":{"line":1,"column":478}},{"source":"../../models/progressModel.js","name":"model","original":{"line":93,"column":26},"generated":{"line":1,"column":480}},{"source":"../../models/progressModel.js","original":{"line":93,"column":32},"generated":{"line":1,"column":486}},{"source":"../../models/progressModel.js","name":"progressSchema","original":{"line":93,"column":44},"generated":{"line":1,"column":497}},{"source":"../../models/progressModel.js","name":"module","original":{"line":94,"column":0},"generated":{"line":1,"column":500}},{"source":"../../models/progressModel.js","name":"exports","original":{"line":94,"column":7},"generated":{"line":1,"column":507}},{"source":"../../models/progressModel.js","name":"Progress","original":{"line":94,"column":17},"generated":{"line":1,"column":515}}],"sources":{"../../models/progressModel.js":"const mongoose = require('mongoose');\r\nconst Tour = require('./tourModel');\r\n\r\nconst progressSchema = new mongoose.Schema(\r\n  {\r\n    progress: [Number],\r\n    createdAt: {\r\n      type: Date,\r\n      default: Date.now,\r\n    },\r\n    lesson: {\r\n      type: mongoose.Schema.ObjectId,\r\n      ref: 'Lesson',\r\n      // required: [true, 'Review must belong to a tour.'],\r\n    },\r\n    course: {\r\n      type: mongoose.Schema.ObjectId,\r\n      ref: 'Course',\r\n      // required: [true, 'Review must belong to a tour.'],\r\n    },\r\n    user: {\r\n      type: mongoose.Schema.ObjectId,\r\n      ref: 'User',\r\n      required: [true, 'Progress must belong to an user.'],\r\n    },\r\n  },\r\n  {\r\n    toJSON: { virtuals: true },\r\n    toObject: { virtuals: true },\r\n  }\r\n);\r\n\r\nprogressSchema.index({ lesson: 1, user: 1 }, { unique: true });\r\n\r\n// QUERRY MIDDLEWARE\r\nprogressSchema.pre(/^find/, function (next) {\r\n  // this.populate({\r\n  //   path: 'tour',\r\n  //   select: 'name',\r\n  // }).populate({\r\n  //   path: 'user',\r\n  //   select: 'name photo',\r\n  // });\r\n  this.populate({\r\n    path: 'user',\r\n    select: 'name photo',\r\n  });\r\n  next();\r\n});\r\n\r\n// progressSchema.statics.calcAverageRatings = async function (tourId) {\r\n//   const stats = await this.aggregate([\r\n//     {\r\n//       $match: { tour: tourId },\r\n//     },\r\n//     {\r\n//       $group: {\r\n//         _id: '$tour',\r\n//         nRatings: { $sum: 1 },\r\n//         avgRating: { $avg: '$rating' },\r\n//       },\r\n//     },\r\n//   ]);\r\n\r\n//   if (stats.length > 0) {\r\n//     await Tour.findByIdAndUpdate(tourId, {\r\n//       ratingsQuantity: stats[0].nRating,\r\n//       ratingsAverage: stats[0].avgRating,\r\n//     });\r\n//   } else {\r\n//     await Tour.findByIdAndUpdate(tourId, {\r\n//       ratingsQuantity: 0,\r\n//       ratingsAverage: 4.5,\r\n//     });\r\n//   }\r\n// };\r\n\r\n// progressSchema.post('save', function () {\r\n//   // this points to current review\r\n//   this.constructor.calcAverageRatings(this.tour);\r\n// });\r\n\r\n// progressSchema.pre(/^findOneAnd/, async function (next) {\r\n//   this.r = await this.findOne();\r\n//   next();\r\n// });\r\n\r\n// progressSchema.post(/^findOneAnd/, async function () {\r\n//   // await this.findOne(); does NOT work here, query has already excuted\r\n//   await this.r.constructor.calcAverageRatings(this.r);\r\n// });\r\n\r\nconst Progress = mongoose.model('Progress', progressSchema);\r\nmodule.exports = Progress;\r\n"},"lineCount":null}},"error":null,"hash":"3b768cb46e2f6894158bbba03b83b521","cacheData":{"env":{}}}